#!/usr/bin/env bash

set -e

# Use context-jetpack from bin directory
script_dir=$( cd -- "$( dirname -- "${BASH_SOURCE[0]}" )" &> /dev/null && pwd )
context_jetpack="$script_dir/bin/context-jetpack"

# Tiles - download all related packages together
"$context_jetpack" androidx.wear.tiles:tiles{,-renderer,-testing} STABLE
"$context_jetpack" androidx.wear.tiles:tiles{,-renderer,-testing} LATEST

# Protolayout - download all related packages together
PROTO_STABLE_DIR=$("$context_jetpack" androidx.wear.protolayout:protolayout{,-expression,-material,-material3} STABLE)
"$context_jetpack" androidx.wear.protolayout:protolayout{,-expression,-material,-material3} LATEST

# Copy protolayout STABLE to persistent location
CONTEXT_DIR="$HOME/.context"
PROTO_CONTEXT_DIR="$CONTEXT_DIR/androidx-wear-protolayout"

mkdir -p "$CONTEXT_DIR"
if [ -d "$PROTO_CONTEXT_DIR" ]; then
  rm -rf "$PROTO_CONTEXT_DIR"/*
fi
mkdir -p "$PROTO_CONTEXT_DIR"
cp -r "$PROTO_STABLE_DIR"/* "$PROTO_CONTEXT_DIR/"

echo "info: Copied protolayout STABLE to $PROTO_CONTEXT_DIR" >&2

# Compose
"$context_jetpack" androidx.wear.compose:compose-material3 STABLE

# Horologist
"$context_jetpack" com.google.android.horologist:horologist-datalayer STABLE https://repo1.maven.org/maven2

# Ongoing
"$context_jetpack" androidx.wear:wear-ongoing STABLE

echo "All packages downloaded."
